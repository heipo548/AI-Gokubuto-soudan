option_settings:
  aws:elasticbeanstalk:application:environment:
    NODE_ENV: production
    NPM_CONFIG_PRODUCTION: false
    NPM_CONFIG_UNSAFE_PERM: true
    NPM_CONFIG_TIMEOUT: 600000
    NPM_CONFIG_FUND: false
    NPM_CONFIG_AUDIT: false
    PORT: 8080
  aws:autoscaling:launchconfiguration:
    InstanceType: t3.micro
  aws:elasticbeanstalk:container:nodejs:
    NodeCommand: "npm start"
    GzipCompression: true
  aws:elasticbeanstalk:healthreporting:system:
    SystemType: enhanced
    HealthCheckSuccessThreshold: Warning

commands:
  01_increase_swap:
    command: |
      sudo fallocate -l 2G /swapfile
      sudo chmod 600 /swapfile
      sudo mkswap /swapfile
      sudo swapon /swapfile
    ignoreErrors: true
  02_npm_config:
    command: "npm config set fetch-timeout 600000"
    ignoreErrors: true
  03_npm_registry:
    command: "npm config set registry https://registry.npmjs.org/"
    ignoreErrors: true
