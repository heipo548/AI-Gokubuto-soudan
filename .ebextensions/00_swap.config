commands:
  01_create_swap_file:
    command: "sudo fallocate -l 2G /swapfile"
    test: "test ! -f /swapfile" # /swapfile が存在しない場合のみ実行
  02_set_permissions:
    command: "sudo chmod 600 /swapfile"
    test: "test -f /swapfile" # /swapfile が存在する場合のみ実行 (01が成功した場合など)
  03_mkswap:
    command: "sudo mkswap /swapfile"
    # /swapfile が存在し、かつ、まだswapとしてフォーマットされていない場合のみ実行
    test: "test -f /swapfile && ! sudo blkid -t TYPE=swap /swapfile >/dev/null 2>&1"
  04_swapon:
    command: "sudo swapon /swapfile"
    # /swapfile が存在し、swapとしてフォーマット済みで、かつ、まだ有効化されていない場合のみ実行
    test: "test -f /swapfile && sudo blkid -t TYPE=swap /swapfile >/dev/null 2>&1 && ! grep -q '^\/swapfile' /proc/swaps"

files:
  "/etc/fstab":
    mode: "000644"
    owner: root
    group: root
    append: true
    content: |
      /swapfile swap swap defaults 0 0